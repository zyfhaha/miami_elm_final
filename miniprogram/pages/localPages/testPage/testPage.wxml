<wxs module="filters" src="../../../lib/calculate/calculate.wxs"></wxs>
<wxs module="toLocalTime" src="../../../lib/goods/toLocalTime.wxs"></wxs>
<view class="order_content">
    <!-- 订单基础信息: 单号，顾客名，电话，地址 -->
    <view class="basic_info">
        <view class="order_num"># {{orderDetail.orderNum}}</view>
        <view class="customer_name">{{orderDetail.receiverName}}</view>
        <view class="customer_tel" bindtap="handleTapTel">
            <text class="iconfont icon-dianhua"></text>
            联系顾客
        </view>
        <view class="address">{{orderDetail.street}}</view>
        <view wx:if="{{orderDetail.status===-1}}" class="cancel_reason">
            取消原因: {{orderDetail.cancelReason}}
        </view>
        <view class="cancel_order_warp">
            <button wx:if="{{orderSetting.hasTopRightCancelOrderButton}}" class="cancel_order" bindtap="handleTapCancelOrder">
                取消订单
            </button>
            <view wx:elif="{{orderDetail.status==1 && orderSetting.hasStatus}}" class="order_status_complete">
                已完成
            </view>
            <view wx:elif="{{orderDetail.status==2 && orderSetting.hasStatus}}" class="order_status_cancel">
                已取消
            </view>
        </view>
    </view>
    <!-- 商品详情 -->
    <view class="goods">
        <view bindtap="handleTapGoodsDetail" class="goods_title_warp" hover-class="view_hover" hover-stay-time="100">
            <view class="goods_title">商品详情</view>
            <view hidden="{{!(hasDownArror && !orderSetting.hasRightArror)}}" class="iconfont icon-xia"></view>
            <view hidden="{{!(hasUpArror && !orderSetting.hasRightArror)}}" class="iconfont icon-shang"></view>
            <view hidden="{{!(orderSetting.hasRightArror)}}" class="iconfont icon-you"></view>
        </view>
        <checkbox-group wx:if="{{isShowGoodsDetail && !orderSetting.hasRightArror}}" class="checkbox_group" bindchange="handelCheckBoxChange">
            <checkbox wx:for="{{orderDetail.validGoods}}" wx:key="goodsId" class="checkbox_item">
                <view class="goods_item_warp">
                    <view class="goods_pic_warp">
                        <image class="goods_pic" src="{{item.goodsPicUrl}}" mode="widthFix"></image>
                    </view>
                    <view class="goods_name_num">
                        <view class="goods_name">{{item.goodsName}}</view>
                        <view class="goods_num">x{{item.num}}</view>
                    </view>
                    <view class="goods_price">${{filters.toFix(item.num * item.goodsPrice)}}</view>
                </view>
            </checkbox>
            <checkbox class="checkbox_item">
                <view class="note">
                    <text class="note_title">备注:<text class="note_content">{{orderDetail.note}}</text></text>
                </view>
            </checkbox>
        </checkbox-group>
        <view class="total_price">总计: $ {{orderDetail.totalPrice}}</view>
    </view>
    <!-- 是否接单按钮 -->
    <view wx:if="{{orderSetting.hasAcceptOrderButton}}" class="accept_order_warp">
        <view class="cancel_btn_warp">
            <button bindtap="handleTapCancelOrder" class="cancel_btn" type="primary" plain="{{true}}">
                取消订单
            </button>
        </view>
        <view class="accept_btn_warp">
            <button bindtap="handleTapAcceptOrder" class="cancel_btn" type="primary">接单</button>
        </view>
    </view>
    <!-- 是否完成订单按钮 -->
    <view wx:if="{{orderSetting.hasCompleteOrderButton}}" class="complete_order_warp">
        <view class="complete_btn_warp">
            <button bindtap="handleTapCompleteOrder" class="complete_btn" type="primary" disabled="{{!isAllChecked}}">
                完成订单
            </button>
        </view>
        <view class="copy_info_btn_warp">
            <button bindtap="handleTapCopyInfo" class="copy_info_btn" type="primary" disabled="{{!isAllChecked}}">
                复制订单信息
            </button>
        </view>
    </view>
    <!-- 订单其他信息：下单时间，订单编号 -->
        <view class="other_info">
            <view class="info_warp">
                <view class="item note">订单备注: {{orderDetail.note}}</view>
                <view class="item order_id">订单编号: {{orderDetail.orderId}}</view>
                <view class="item payTime">
                    下单时间: {{toLocalTime.formatTime(orderDetail.payTime)}}
                </view>
                <view class="item selDeliverTime">
                    预定配送时间: {{toLocalTime.formatTime(orderDetail.selDeliverTime)}}
                </view>
                <view wx:if="{{orderDetail.deliverTime}}" class="item deliverTime">
                    实际配送时间: {{toLocalTime.formatTime(orderDetail.deliverTime)}}
                </view>
                <view wx:if="{{orderDetail.completeTime}}" class="item completeTime">
                    送达时间: {{toLocalTime.formatTime(orderDetail.completeTime)}}
                </view>
            </view>
        </view>
</view>